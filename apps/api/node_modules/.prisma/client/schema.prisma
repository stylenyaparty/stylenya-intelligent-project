generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  name         String?
  role         UserRole @default(USER)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  passwordHash String
}

model Product {
  id            String        @id @default(uuid())
  name          String
  productSource ProductSource
  productType   String
  status        ProductStatus @default(ACTIVE)
  seasonality   Seasonality   @default(NONE)

  shopifyProductId String?
  etsyListingId    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  salesRecords SalesRecord[]
  requests     Request[]

  decisions Decision[]
}

model SalesRecord {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id])

  salesPeriod   SalesPeriod
  unitsSold     Int
  revenueAmount Decimal

  asOfDate  DateTime
  createdAt DateTime @default(now())
}

model Request {
  id          String         @id @default(uuid())
  channel     RequestChannel
  theme       String
  productType String?
  status      RequestStatus  @default(NEW)

  productId String?
  product   Product? @relation(fields: [productId], references: [id])

  createdAt DateTime @default(now())
}

model Settings {
  id                            Int    @id @default(1)
  boostSalesThresholdD90        Int    @default(10)
  retireSalesThresholdD180      Int    @default(2)
  requestThemePriorityThreshold Int    @default(3)
  defaultCurrency               String @default("USD")

  updatedAt DateTime @updatedAt
}

model DecisionLog {
  id            String   @id @default(uuid())
  weekStart     DateTime
  engineVersion String   @default("v1")

  // snapshot JSON de items (WeeklyFocusItem[])
  itemsJson Json

  createdAt DateTime @default(now())

  @@unique([weekStart, engineVersion])
  @@index([weekStart])
}

model Decision {
  id String @id @default(uuid())

  decisionType DecisionType
  status       DecisionStatus @default(PLANNED)

  // Target (por ahora solo PRODUCT; luego ampliamos a THEME/COLLECTION si quieres)
  productId String
  product   Product @relation(fields: [productId], references: [id])

  rationale      String
  expectedImpact String?

  // Opcional: guardar la recomendaci√≥n del engine al momento de decidir
  engineVersion  String @default("v1")
  engineSnapshot Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([createdAt])
  @@index([decisionType, status])
  @@index([productId])
}

enum UserRole {
  ADMIN
  USER
}

enum ProductSource {
  ETSY
  SHOPIFY
  BOTH
}

enum ProductStatus {
  ACTIVE
  DRAFT
  ARCHIVED
}

enum Seasonality {
  NONE
  VALENTINES
  EASTER
  BACK_TO_SCHOOL
  HALLOWEEN
  CHRISTMAS
  CUSTOM
}

enum SalesPeriod {
  D30
  D90
  D180
  D365
}

enum RequestChannel {
  WHATSAPP
  FORM
  MANUAL
}

enum RequestStatus {
  NEW
  REVIEWED
  FULFILLED
  DISMISSED
}

enum DecisionTargetType {
  PRODUCT
  THEME
}

enum DecisionType {
  MIGRATE
  BOOST
  KEEP
  PAUSE
  RETIRE
  LAUNCH
  PROMOTE
}

enum DecisionStatus {
  PLANNED
  EXECUTED
  MEASURED
  CANCELLED
}
